# This is just a draft to get it in line with CQL,but needs much more work and validation.
# It is also waiting for a final release of the OpenAPI document to replace the reference in the filter schema to the OAFeat master branch on GitHub

paths:
  /search:
    get:
      parameters:
        - $ref: '#/components/parameters/filter'
        - $ref: '#/components/parameters/filter-lang'
components:
  parameters:
    filter:
      name: filter
      in: query
      description: Filter for properties in items. Uses OGC's Common Query Language (CQL) text (cql-text) from part 3 of OGC API - Features.
      required: false
      schema:
        type: string
      style: form
      examples: 
        cql-text: polarization is "HH+VV+HV+VH" and intersects geom(Washington DC)
        cql-json:
          and:
            - lt: 
                property: cloud_cover
                value: 10
            - eq: 
                property: platform
                value: 'landsat8'
            - like:
                property: pl:item_type
                value: 'PSScene%'
            - in: 
                property: gsd
                value:
                  - 10
                  - 15
                  - 20
    filter-lang:
      name: filter-lang
      in: query
      required: false
      schema:
        type: string
        enum:
          - cql-text
          - cql-json
        default: cql-text
      style: form
  schemas:
    filter-lang:
    searchBody:
      allOf:
        - $ref: '#/components/schemas/queryFilter'
    queryFilter:
      type: object
      description: Filter for properties in items. Uses OGC's Common Query Language (CQL) JSON (cql-json) from part 3 of OGC API - Features.
      properties:
        filter:
          $ref: '#/components/schemas/filter'
        filter-lang:
          type: string
          enum:
            - cql-text
            - cql-json
          default: cql-json
    filter:
      description: Filter for properties in items. Uses OGC's Common Query Language (CQL) JSON (cql-json) from part 3 of OGC API - Features.
      allOf:
        - $ref: 'https://raw.githubusercontent.com/opengeospatial/ogcapi-features/master/extensions/cql/standard/schema/cql.yml#/components/schemas/predicates'
       